<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<style>
    *{
        font-family: sans-serif;
    }
</style>
<script>
    let chats = [];
    let messages = [];
    var socket = io.connect('http://localhost:3000');
    socket.on('new_connect', (data)=>{console.log('HUZZAH!'); console.log(data)});
    function onLoad() {
        $.get("http://localhost:3000/chats", function(data, status){
            chats = data.chats;
            
            
            const chatsHtml = chats.map(chat => {
                return `<div>
                    <button onclick='onLoadMessages("${chat._id}")'>
                        OPEN
                    </button>
                    Name: <b>${chat.name}</b>
                    Category: <b>${chat.category}</b>
                    startTime: <b>${chat.startTime}</b>
                    duration: <b>${chat.duration}</b>
                    </div>`
            }).join('');
            document.getElementById('chats').innerHTML = chatsHtml
        });
    }
    function onLoadMessages (id){
        $.get(`http://localhost:3000/${id}/messages`, function(data, status){
            messages = data.messages;
            
            const messagesHtml = messages.map(message => {
                return `<div>
                    <h4'>
                        ${message.user}
                    </h4>
                        ${message.message}
                    </div>`
            }).join('');
            document.getElementById('chatId').innerHTML = id
            document.getElementById('chat').innerHTML = messagesHtml
        });
    }
    function onSend(){
        const messageToSend = document.getElementById('messageToSend').value;
        document.getElementById('messageToSend').value = '';
        console.log(messageToSend)
    }
 
</script>


<h2>
    All chats
    <button onclick='onLoad()'>LOAD</button>
</h2>
<ul id='chats'>

</ul>

<h2>
    Current chat 
    (<span id='chatId'></span>)
</h2>

<div id='chat'>

    
</div>
<input id='messageToSend' type="text">
<button onclick='onSend()'>SEND</button>